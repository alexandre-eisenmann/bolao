<!DOCTYPE html>
<html>
<head>
  <script src="d3.v3.min.js" charset="utf-8"></script>
  <script src="jquery-2.1.1.min.js" charset="utf-8"></script>
  <script src="data.js" charset="utf-8"></script>
  <script src="bolao.js" charset="utf-8"></script>
  <link rel="stylesheet" type="text/css" href="bolao.css">
</head>
<body>

  <div class="header">
    <div class="game done">
      <div class="left">BRA</div>
      <div class="right">CRO</div>
      <div class="left-gols">3</div>
      <div class="right-gols">1</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">MEX</div>
      <div class="right">CAM</div>
      <div class="left-gols">1</div>
      <div class="right-gols">0</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">ESP</div>
      <div class="right">HOL</div>
      <div class="left-gols">1</div>
      <div class="right-gols">5</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">CHI</div>
      <div class="right">AUS</div>
      <div class="left-gols">3</div>
      <div class="right-gols">1</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">COL</div>
      <div class="right">GRE</div>
      <div class="left-gols">3</div>
      <div class="right-gols">0</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">URU</div>
      <div class="right">COS</div>
      <div class="left-gols">1</div>
      <div class="right-gols">3</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">ING</div>
      <div class="right">ITA</div>
      <div class="left-gols">1</div>
      <div class="right-gols">2</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">CDM</div>
      <div class="right">JAP</div>
      <div class="left-gols">2</div>
      <div class="right-gols">1</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">SUI</div>
      <div class="right">EQU</div>
      <div class="left-gols">2</div>
      <div class="right-gols">1</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">FRA</div>
      <div class="right">HON</div>
      <div class="left-gols">3</div>
      <div class="right-gols">0</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">ARG</div>
      <div class="right">BOS</div>
      <div class="left-gols">2</div>
      <div class="right-gols">1</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">ALE</div>
      <div class="right">POR</div>
      <div class="left-gols">4</div>
      <div class="right-gols">0</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">IRA</div>
      <div class="right">NIG</div>
      <div class="left-gols">0</div>
      <div class="right-gols">0</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">GAN</div>
      <div class="right">EUA</div>
      <div class="left-gols">1</div>
      <div class="right-gols">2</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">BEL</div>
      <div class="right">AGL</div>
      <div class="left-gols">2</div>
      <div class="right-gols">1</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">BRA</div>
      <div class="right">MEX</div>
      <div class="left-gols">0</div>
      <div class="right-gols">0</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">RUS</div>
      <div class="right">COR</div>
      <div class="left-gols">1</div>
      <div class="right-gols">1</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">AUS</div>
      <div class="right">HOL</div>
      <div class="left-gols">2</div>
      <div class="right-gols">3</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">ESP</div>
      <div class="right">CHI</div>
      <div class="left-gols">0</div>
      <div class="right-gols">2</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">CRO</div>
      <div class="right">CAM</div>
      <div class="left-gols">4</div>
      <div class="right-gols">0</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">COL</div>
      <div class="right">CDM</div>
      <div class="left-gols">2</div>
      <div class="right-gols">1</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">URU</div>
      <div class="right">ING</div>
      <div class="left-gols">2</div>
      <div class="right-gols">1</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">JAP</div>
      <div class="right">GRE</div>
      <div class="left-gols">0</div>
      <div class="right-gols">0</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">ITA</div>
      <div class="right">COS</div>
      <div class="left-gols">0</div>
      <div class="right-gols">1</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">SUI</div>
      <div class="right">FRA</div>
      <div class="left-gols">2</div>
      <div class="right-gols">5</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">HON</div>
      <div class="right">EQU</div>
      <div class="left-gols">1</div>
      <div class="right-gols">2</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">ARG</div>
      <div class="right">IRA</div>
      <div class="left-gols">1</div>
      <div class="right-gols">0</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game done">
      <div class="left">ALE</div>
      <div class="right">GAN</div>
      <div class="left-gols">2</div>
      <div class="right-gols">2</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">NIG</div>
      <div class="right">BOS</div>
      <div class="left-gols">1</div>
      <div class="right-gols">0</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">BEL</div>
      <div class="right">RUS</div>
      <div class="left-gols">1</div>
      <div class="right-gols">0</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">COR</div>
      <div class="right">AGL</div>
      <div class="left-gols">2</div>
      <div class="right-gols">4</div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">EUA</div>
      <div class="right">POR</div>
      <div class="left-controllers"><span class="menos">-</span><span class="left-gols"></span><span class="mais">+</span></div>
      <div class="right-controllers"><span class="menos">-</span><span class="right-gols"></span><span class="mais">+</span></div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">AUS</div>
      <div class="right">ESP</div>
      <div class="left-controllers"><span class="menos">-</span><span class="left-gols"></span><span class="mais">+</span></div>
      <div class="right-controllers"><span class="menos">-</span><span class="right-gols"></span><span class="mais">+</span></div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">HOL</div>
      <div class="right">CHI</div>
      <div class="left-controllers"><span class="menos">-</span><span class="left-gols"></span><span class="mais">+</span></div>
      <div class="right-controllers"><span class="menos">-</span><span class="right-gols"></span><span class="mais">+</span></div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">CAM</div>
      <div class="right">BRA</div>
      <div class="left-controllers"><span class="menos">-</span><span class="left-gols"></span><span class="mais">+</span></div>
      <div class="right-controllers"><span class="menos">-</span><span class="right-gols"></span><span class="mais">+</span></div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">CRO</div>
      <div class="right">MEX</div>
      <div class="left-controllers"><span class="menos">-</span><span class="left-gols"></span><span class="mais">+</span></div>
      <div class="right-controllers"><span class="menos">-</span><span class="right-gols"></span><span class="mais">+</span></div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">COS</div>
      <div class="right">ING</div>
      <div class="left-controllers"><span class="menos">-</span><span class="left-gols"></span><span class="mais">+</span></div>
      <div class="right-controllers"><span class="menos">-</span><span class="right-gols"></span><span class="mais">+</span></div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">ITA</div>
      <div class="right">URU</div>
      <div class="left-controllers"><span class="menos">-</span><span class="left-gols"></span><span class="mais">+</span></div>
      <div class="right-controllers"><span class="menos">-</span><span class="right-gols"></span><span class="mais">+</span></div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">GRE</div>
      <div class="right">CDM</div>
      <div class="left-controllers"><span class="menos">-</span><span class="left-gols"></span><span class="mais">+</span></div>
      <div class="right-controllers"><span class="menos">-</span><span class="right-gols"></span><span class="mais">+</span></div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">JAP</div>
      <div class="right">COL</div>
      <div class="left-controllers"><span class="menos">-</span><span class="left-gols"></span><span class="mais">+</span></div>
      <div class="right-controllers"><span class="menos">-</span><span class="right-gols"></span><span class="mais">+</span></div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">BOS</div>
      <div class="right">IRA</div>
      <div class="left-controllers"><span class="menos">-</span><span class="left-gols"></span><span class="mais">+</span></div>
      <div class="right-controllers"><span class="menos">-</span><span class="right-gols"></span><span class="mais">+</span></div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">NIG</div>
      <div class="right">ARG</div>
      <div class="left-controllers"><span class="menos">-</span><span class="left-gols"></span><span class="mais">+</span></div>
      <div class="right-controllers"><span class="menos">-</span><span class="right-gols"></span><span class="mais">+</span></div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">EQU</div>
      <div class="right">FRA</div>
      <div class="left-controllers"><span class="menos">-</span><span class="left-gols"></span><span class="mais">+</span></div>
      <div class="right-controllers"><span class="menos">-</span><span class="right-gols"></span><span class="mais">+</span></div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">HON</div>
      <div class="right">SUI</div>
      <div class="left-controllers"><span class="menos">-</span><span class="left-gols"></span><span class="mais">+</span></div>
      <div class="right-controllers"><span class="menos">-</span><span class="right-gols"></span><span class="mais">+</span></div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">POR</div>
      <div class="right">GAN</div>
      <div class="left-controllers"><span class="menos">-</span><span class="left-gols"></span><span class="mais">+</span></div>
      <div class="right-controllers"><span class="menos">-</span><span class="right-gols"></span><span class="mais">+</span></div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">EUA</div>
      <div class="right">ALE</div>
      <div class="left-controllers"><span class="menos">-</span><span class="left-gols"></span><span class="mais">+</span></div>
      <div class="right-controllers"><span class="menos">-</span><span class="right-gols"></span><span class="mais">+</span></div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">AGL</div>
      <div class="right">RUS</div>
      <div class="left-controllers"><span class="menos">-</span><span class="left-gols"></span><span class="mais">+</span></div>
      <div class="right-controllers"><span class="menos">-</span><span class="right-gols"></span><span class="mais">+</span></div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
    <div class="game">
      <div class="left">COR</div>
      <div class="right">BEL</div>
      <div class="left-controllers"><span class="menos">-</span><span class="left-gols"></span><span class="mais">+</span></div>
      <div class="right-controllers"><span class="menos">-</span><span class="right-gols"></span><span class="mais">+</span></div>
      <div class="stats0"></div>
      <div class="stats3"></div>
      <div class="stats5"></div>
      <div class="stats8"></div>
    </div>
  </div>
  <div class="botoes" >
    <div id="stepfast" class="botao clickable">Estou com pressa</div>
    <div id="step" class="botao clickable">Calcular proximo jogo</div>
  </div>
  <div id="jogos"></div>
  <div id="resultados"></div>

<script type="text/javascript">

var selectGame = getParameterByName("selectGame");

function updateStats(gameElement, stats) {
     gameElement.find('.stats0').html(stats[0]);
     gameElement.find('.stats3').html(stats[3]);
     gameElement.find('.stats5').html(stats[5]);
     gameElement.find('.stats8').html(stats[8]);
}

function  calculateGames(gamesArray, updateFunction) {
  if (gamesArray && gamesArray.length == 0)
    return

  var game = gamesArray[0];
  game.element.toggleClass("calculando");
  updateFunction(game.left, game.right, function(stats) {
     updateStats(game.element, stats);
     game.element.toggleClass("calculando");
     game.element.toggleClass("calculado");
     if (gamesArray.length == 1) {
       game.element.toggleClass("select-game");
     }
     calculateGames(gamesArray.slice(1), updateFunction);


  })
}


$( document ).ready(function() {

   sort();
   start();
   var update = buildUpdate(6);

    mode = 'pressa';
    rainDuration = 0;
    sortDuration = 0;
    goLeftDuration = 0;
    assyncDurationDown = 0;
    assyncDurationUp = 0;
    pointsDuration = 0;

   var canCalculate=true;
   var toBeCalculated = [];

   $(".game").each(function() {
      var jqGame = $(this);
      var left = jqGame.find('.left').html();
      var right = jqGame.find('.right').html();
      var leftGols = jqGame.find('.left-gols').html();
      var rightGols = jqGame.find('.right-gols').html();

      var game = (left+""+right).toLowerCase();
      var results = getParameterByName(game).split("-");

      if (results && results.length==2) {
        leftGols = results[0];
        rightGols = results[1];
        $(this).find('.left-gols').html(leftGols);
        $(this).find('.right-gols').html(rightGols);
      }

      if (canCalculate && leftGols && rightGols) {
        toBeCalculated.push({left: leftGols, right: rightGols, element: jqGame, name: game});
      }

      if (selectGame && selectGame == game) {
        canCalculate=false;
      }


    });

    calculateGames(toBeCalculated, update);






    var process = function() {

        var botao  = $(this).attr("id");
        if (!$(this).hasClass("clickable"))
          return;


        if (botao == "stepfast") {
          mode = 'pressa';
          rainDuration = 0;
          sortDuration = 0;
          goLeftDuration = 0;
          assyncDurationDown = 0;
          assyncDurationUp = 0;
          pointsDuration = 0;

        } else {
          mode = 'animacao';
          rainDuration = 1000;
          sortDuration = 500;
          goLeftDuration = 50;
          assyncDurationDown = 30;
          assyncDurationUp = 10;
          pointsDuration = 20;
        }






       var selectGame = $(".select-game").first();
       var game;
       if (selectGame.length > 0 ) {
         game = selectGame.next()
       } else {
         game = $(".game").first()
       }

       var leftGols = game.find('.left-gols').html();
       var rightGols = game.find('.right-gols').html();

       if (leftGols && rightGols) {
         $(this).toggleClass("clickable");

         if (selectGame.length > 0 ) selectGame.toggleClass("select-game")
         game.toggleClass("select-game");

         update(leftGols, rightGols, function(stats) {
            $("#"+ botao).toggleClass("clickable");
            updateStats(game, stats);
            $(window).scrollTop(0);
         });
      }
    }

    $(".clickable").click(process);

    $(".left-controllers .menos").click(function() {

      var value = parseInt($(this).parent().find('.left-gols').html());
      if (value > 0) value--; else value = 0;
      $(this).parent().find('.left-gols').html(value);

    });

    $(".left-controllers .mais").click(function() {
      var value = parseInt($(this).parent().find('.left-gols').html());
      if (value >= 0) value++; else value = 0;
      $(this).parent().find('.left-gols').html(value);

    });

    $(".right-controllers .menos").click(function() {

      var value = parseInt($(this).parent().find('.right-gols').html());
      if (value > 0) value--; else value = 0;
      $(this).parent().find('.right-gols').html(value);

    });

    $(".right-controllers .mais").click(function() {
      var value = parseInt($(this).parent().find('.right-gols').html());
      if (value >= 0) value++; else value = 0;
      $(this).parent().find('.right-gols').html(value);

    });



     $(document.body).on('click', '.done', function() {
      var jqGame = $(this);
      var left = jqGame.find('.left').html();
      var right = jqGame.find('.right').html();
      if (window.location.href.indexOf('selectGame=')>=0) {
        window.location.href = window.location.href.replace(/(selectGame=)[^\&]+/, '$1' +(left + ""+right).toLowerCase());
      } else {
        window.location.href = window.location.href + "?selectGame="+(left+""+right).toLowerCase();
      }
     $()


    });


});

</script>
</body>
</html>
